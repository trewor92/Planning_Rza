import * as R from 'ramda'
import {FETCH_ELEMENTS_TO_TREE_SUCCESS,
CHANGE_FOLDER_CONDITION_IN_TREE} from 'actionTypes'

const initialState = []

export default (state=initialState, {type,payload})=>
{
  switch (type) {
    case FETCH_ELEMENTS_TO_TREE_SUCCESS:
    const childIds = R.map(R.prop('id'))(payload.childs)
    const nodes = R.map(
                    R.ifElse(
                      R.propEq('id', payload.id),
                      R.assoc('children', childIds),
                      x => x))(state)

      return R.concat(nodes, payload.childs)
    case CHANGE_FOLDER_CONDITION_IN_TREE:
      return R.map(
        R.ifElse(
          R.propEq('id', payload),
          node=>R.assoc('isOpen', R.not(R.prop('isOpen',node)))(node),
          node=>node))(state)
    default:
      return state
  }
}
